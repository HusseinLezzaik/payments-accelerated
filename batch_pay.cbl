IDENTIFICATION DIVISION.
PROGRAM-ID. BATCHPAYMENTPROCESSING.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACTION.DAT'
        ORGANIZATION IS LINE SEQUENTIAL.
    SELECT OUTPUT-FILE ASSIGN TO 'OUTPUT.DAT'
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD TRANSACTION-FILE.
01 TRANSACTION-RECORD.
    05 TR-ACCOUNT-NUMBER    PIC 9(6).
    05 FILLER               PIC X(1).
    05 TR-AMOUNT            PIC 9(5)V99.
    05 FILLER               PIC X(1).
    05 TR-TRANSACTION-CODE  PIC X(4).
    05 FILLER               PIC X(1).
    05 TR-TRANSACTION-DESCRIPTION PIC X(40).

FD OUTPUT-FILE.
01 OUTPUT-RECORD.
    05 OR-ACCOUNT-NUMBER    PIC 9(6).
    05 OR-AMOUNT            PIC ZZZZZ9.99.
    05 OR-TRANSACTION-CODE  PIC X(4).
    05 OR-TRANSACTION-DESCRIPTION PIC X(40).

WORKING-STORAGE SECTION.
01 WS-EOF                  PIC X(3)       VALUE 'NO'.
01 WS-TOTAL-AMOUNT         PIC 9(5)V99    VALUE ZERO.
01 WS-OUTPUT-LINE          PIC ZZZZZ9.99  VALUE SPACES.
01 WS-CHAR                 PIC X.
01 WS-AMOUNT-INTEGER       PIC 9(5)       VALUE ZERO.
01 WS-AMOUNT-DECIMAL       PIC 9(2)       VALUE ZERO.
01 WS-TOTAL-AMOUNT-INTEGER PIC 9(5)       VALUE ZERO.
01 WS-TOTAL-AMOUNT-DECIMAL PIC 9(2)       VALUE ZERO.

PROCEDURE DIVISION.
OPEN-FILES.
    OPEN INPUT TRANSACTION-FILE OUTPUT OUTPUT-FILE.
    PERFORM UNTIL WS-EOF = 'YES'
        READ TRANSACTION-FILE INTO TRANSACTION-RECORD
            AT END MOVE 'YES' TO WS-EOF
        END-READ
        IF WS-EOF = 'NO'
            PERFORM PROCESS-TRANSACTION
        END-IF
    END-PERFORM.
    CLOSE TRANSACTION-FILE OUTPUT-FILE.
    STOP RUN.

PROCESS-TRANSACTION.
    MOVE TR-AMOUNT TO WS-OUTPUT-LINE.
    IF TR-TRANSACTION-CODE = ' DEP'
        ADD TR-AMOUNT TO WS-TOTAL-AMOUNT
    ELSE IF TR-TRANSACTION-CODE = ' WDR'
        SUBTRACT TR-AMOUNT FROM WS-TOTAL-AMOUNT
    END-IF
    MOVE TR-ACCOUNT-NUMBER TO OR-ACCOUNT-NUMBER
    MOVE WS-OUTPUT-LINE TO OR-AMOUNT
    MOVE TR-TRANSACTION-CODE TO OR-TRANSACTION-CODE
    MOVE TR-TRANSACTION-DESCRIPTION TO OR-TRANSACTION-DESCRIPTION
    WRITE OUTPUT-RECORD FROM OUTPUT-RECORD AFTER ADVANCING 1 LINE.
